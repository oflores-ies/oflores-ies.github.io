
<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Mesurador de distàncies</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
  input { margin-left: 5px; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>Mesurador de Latitud i Longitud</h2>

<button onclick="mesura()">Mesura</button>
<table id="mesuresTable">
  <tr>
    <th>#</th>
    <th>Latitud</th>
    <th>Longitud</th>
    <th>Ubicació</th>
  </tr>
</table>

<h3>Distàncies pas a pas</h3>
<div id="distancies"></div>

<script>
let mesures = [];

function mesura() {
  if (!navigator.geolocation) {
    alert("La geolocalització no és compatible amb aquest navegador.");
    return;
  }

  navigator.geolocation.getCurrentPosition((pos) => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const ubicacio = prompt("Indica el lloc on s'ha fet la mesura:");

    mesures.push({lat, lon, ubicacio});
    actualitzaTaula();
    calculaDistancies();
  }, (err) => {
    alert("Error al obtenir la localització: " + err.message);
  });
}

function actualitzaTaula() {
  const table = document.getElementById("mesuresTable");
  // netegem totes les files excepte la capçalera
  table.innerHTML = `
    <tr>
      <th>#</th>
      <th>Latitud</th>
      <th>Longitud</th>
      <th>Ubicació</th>
    </tr>`;
  mesures.forEach((m, i) => {
    const row = table.insertRow();
    row.insertCell(0).textContent = i+1;
    row.insertCell(1).textContent = m.lat.toFixed(6);
    row.insertCell(2).textContent = m.lon.toFixed(6);
    row.insertCell(3).textContent = m.ubicacio;
  });
}

function calculaDistancies() {
  const div = document.getElementById("distancies");
  if (mesures.length < 2) {
    div.innerHTML = "Afegiu almenys dues mesures per calcular distàncies.";
    return;
  }

  let html = "";
  for (let i = 0; i < mesures.length - 1; i++) {
    const p1 = mesures[i];
    const p2 = mesures[i+1];

    // Pitàgores (aproximació)
    const dx = (p2.lon - p1.lon) * Math.cos((p1.lat + p2.lat)/2 * Math.PI/180) * 111.32; // km
    const dy = (p2.lat - p1.lat) * 110.574; // km
    const distPitag = Math.sqrt(dx*dx + dy*dy);

    // Haversine
    const R = 6371; // radi de la Terra en km
    const dLat = (p2.lat - p1.lat) * Math.PI/180;
    const dLon = (p2.lon - p1.lon) * Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(p1.lat*Math.PI/180)*Math.cos(p2.lat*Math.PI/180)*Math.sin(dLon/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distHav = R * c;

    html += `
      <p><b>${i+1} → ${i+2}:</b> ${p1.ubicacio} → ${p2.ubicacio} <br>
      Pitàgores: ${distPitag.toFixed(3)} km, Haversine: ${distHav.toFixed(3)} km</p>`;
  }

  div.innerHTML = html;
}
</script>

</body>
</html>
